---
import type { SerializedLexicalNode } from "@payloadcms/richtext-lexical/lexical";

import type { AstroConverters, RichTextConfig } from "../types";
import { getConverterForNode } from "../utils/converterSelection";
import { computeNodeStyles } from "../utils/styleComputation";

interface Props {
	node: SerializedLexicalNode;
	converters: AstroConverters;
	config: RichTextConfig;
}

const { node, converters, config } = Astro.props;

const Converter = getConverterForNode(node, converters);

if (!Converter) {
	console.warn(
		`[astro-richtext-renderer] No converter for node type: "${node.type}"`,
	);
}

const style = computeNodeStyles(node, config);

// Use Astro.self to allow recursive rendering
const BoundRenderNode = Astro.self;
---

{
  Converter && (
    <Converter
      node={node}
      converters={converters}
      config={config}
      style={style}
      RenderNode={BoundRenderNode}
    />
  )
}
