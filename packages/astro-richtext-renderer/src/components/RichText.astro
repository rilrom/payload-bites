---
import {
  convertLexicalToHTML,
  defaultHTMLConverters,
  type HTMLConverters,
  type HTMLConvertersFunction,
} from "@payloadcms/richtext-lexical/html";
import { type SerializedEditorState } from "@payloadcms/richtext-lexical/lexical";

type Props = {
  /**
   * Override class names for the container.
   */
  class?: string;
  /**
   * Custom converters to transform your nodes to HTML. Can be an object or a function that receives the default converters.
   */
  converters?: HTMLConverters | HTMLConvertersFunction;
  /**
   * Serialized editor state to render.
   */
  data: SerializedEditorState;
  /**
   * If true, removes the container div wrapper.
   */
  disableContainer?: boolean;
  /**
   * If true, disables indentation globally. If an array, disables for specific node `type` values.
   */
  disableIndent?: boolean | string[];
  /**
   * If true, disables text alignment globally. If an array, disables for specific node `type` values.
   */
  disableTextAlign?: boolean | string[];
};

const {
  data: editorState,
  converters,
  class: className = "payload-richtext",
  disableContainer = false,
  disableIndent = false,
  disableTextAlign = false,
} = Astro.props;

let finalConverters: HTMLConverters = {};
if (converters) {
  if (typeof converters === "function") {
    finalConverters = converters({ defaultConverters: defaultHTMLConverters });
  } else {
    finalConverters = converters;
  }
} else {
  finalConverters = defaultHTMLConverters;
}

const html =
  editorState &&
  !Array.isArray(editorState) &&
  typeof editorState === "object" &&
  "root" in editorState &&
  convertLexicalToHTML({
    converters: finalConverters,
    data: editorState,
    disableIndent,
    disableTextAlign,
  });
---

{disableContainer ? <Fragment set:html={html} /> : <div class={className} set:html={html} />}
